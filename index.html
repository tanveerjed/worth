<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Worth - Zerodha Login Redirect</title>
</head>
<body>
  <p>Logging you in to Zerodha...</p>
  <script>
    // Add delay to ensure page loads fully
    setTimeout(function() {
      try {
        var params = new URLSearchParams(window.location.search);
        var token = params.get("request_token");
        console.log("Token extracted:", token);  // For debugging
        if (token && token.length > 0) {
          var encodedToken = encodeURIComponent(token);
          console.log("Redirecting to:", "worth://zerodha-login?request_token=" + encodedToken);
          window.location.href = "worth://zerodha-login?request_token=" + encodedToken;
        } else {
          console.log("No token found");
          document.body.innerHTML = "<h2 style='color:red;'>Login failed â€” no token received. <a href='https://kite.zerodha.com'>Try again</a></h2>";
        }
      } catch (error) {
        console.error("Script error:", error);
        document.body.innerHTML = "<h2 style='color:red;'>Redirect error. Check console.</h2>";
      }
    }, 1000);  // 1 second delay for reliability
  </script>
</body>
</html>
